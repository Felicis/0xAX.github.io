<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Elixir in action &middot; 0xAX blog</title>

  
  <link rel="stylesheet" href="http://0xax.github.io//css/poole.css">
  <link rel="stylesheet" href="http://0xax.github.io//css/hyde.css">
  <link rel="stylesheet" href="http://0xax.github.io//css/poole-overrides.css">
  <link rel="stylesheet" href="http://0xax.github.io//css/hyde-overrides.css">
  <link rel="stylesheet" href="http://0xax.github.io//css/hyde-x.css">
  <link rel="stylesheet" href="http://0xax.github.io//css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="">
  <meta name="keywords" content="assembly, programming, linux, emacs, kernel">
  <link rel="author" href="http://plus.google.com/Your%20Google&#43;%20profile%20ID">
</head>
<body>
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1 style="font-family: sans-serif; margin-left: 5px;">0xAX blog</h1>
      
    </div>
    <hr/>
    <img src="/2699235.png" alt="Smiley face" height="100" width="100" align="left">
    <label style="margin-top: 10px; top: 5px; margin-left: 3px; position: relative; left: 10px;">
      Hi, I am Alex, better known as <labe style="color: white;">0xAX</label><label style="top: 6px; left: 9px;position: relative;">.</label>
      <br/><br/>
      Blog covers anything I find interesting, low-level programming, elixirlang and erlang programming,
      and of course my favorite emacs.
    </label>
    <hr/>
    <ul class="sidebar-nav">
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/0xAX"><i class="fa fa-github-square fa-2x"></i></a>
      <a href="https://www.linkedin.com/profile/view?id=86504113&amp;trk=hp-identity-photo"><i class="fa fa-linkedin-square fa-2x"></i></a>
      <a href="https://plus.google.com/108105900187376829286/posts"><i class="fa fa-google-plus-square fa-2x"></i></a>
      <a href="https://twitter.com/0xAX"><i class="fa fa-twitter-square fa-2x"></i></a>
      <a href="http://stackoverflow.com/users/274299/0xax"><i class="fa fa-stack-overflow fa-2x"></i></a>
      <a href="http://0xax.gitbooks.io/linux-insides/content/index.html"><i class="fa fa-linux fa-2x"></i></a>

      </li>
    </ul>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Elixir in action</h1>
    <span class="post-date">Apr 14, 2014 &middot; 4 minute read &middot; <a href="http://0xax.github.io/blog/2014/04/14/elixir-in-action/#disqus_thread">Comments</a>
    
      <br/>

      <div style="float:right;">
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="0xAX">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>	
	<div class="g-plusone" data-size="medium"></div>
      </div>
    
    <a class="label" href="http://0xax.github.io//categories/erlang">erlang</a><a class="label" href="http://0xax.github.io//categories/elixir">elixir</a><a class="label" href="http://0xax.github.io//categories/cowboy">cowboy</a>
    </span>
    

<p><em>NOTE</em> that development of the <code>Weber</code> is finished. And if you&rsquo;re interested in web development with elixirlang, take a look on <a href="https://github.com/phoenixframework/phoenix">phoenix</a>.</p>

<p>As you can know from my previous blog posts (<code>Using elixir to write ybot plugins</code>, <code>Example of usage elixir with cowboy</code> and <code>Started to dive into elixir-lang</code>) some times ago i started to learn and use Elixir language. I&rsquo;m using elixir not very much time, but already have some feels about it. Practical part of usage of elixir is - <a href="https://github.com/elixir-web/weber">Weber</a>. It is a MVC web framework for Elixir, and yesterday i released <a href="https://twitter.com/0xAX/status/379319481694048257">Weber-0.0.1</a>.</p>

<p>In this post i will try to describe my feels about Elixir.</p>

<h2 id="mix:5df44b8565d4251e584dfb856f87bd33">Mix</h2>

<p>First of all about mix tool. Mix is a first Elixir&rsquo;s tool with which we meet in practice when started to use the elixir.</p>

<p>Mix is a build tool that provides tasks for creating, compiling, testing (and soon deploying) Elixir projects. Mix is inspired by the Leiningen build tool for Clojure and was written by one of its contributors.</p>

<p>We can create new Elixir project with: mix new project_name Build it with: mix compile Handle dependencies: mix deps.get &amp;&amp; mix deps.compile And the main mix&rsquo;s feature as i think is a support of custum tasks. Mix task is just a Elixir module with mixed Mix.Task and run function. For example i&rsquo;m using custom mix task in Weber for creating new project template:</p>

<pre><code class="language-elixir">defmodule Mix.Tasks.Weber do
 
    @moduledoc &quot;&quot;&quot;

       Create a new weber project template.

       Usage:

         mix weber /home/user/myWebApp - Creates myWebApp directory with weber project skeleton.
         mix weber --version - Prints weber version.
    &quot;&quot;&quot;
 
    @shortdoc &quot;Create a new weber project&quot;
 
    use Mix.Task
    
    @version Weber.Mixfile.project[:version]
    
    def run([]) do
        usage
    end
 
    def run([&quot;--help&quot;]) do
        usage
    end
 
    def run([&quot;--version&quot;]) do
        Mix.shell.info &quot;Weber v#{@version}&quot;
    end
 
    def run([args]) do
      #
      # Create here new project template
      #
      .....
    end
end
</code></pre>

<h2 id="otp:5df44b8565d4251e584dfb856f87bd33">OTP</h2>

<p>As Elixir is built on top of Erlang virtual machine, we can easily to build OTP application with Elixir:</p>

<pre><code class="language-elixir">defmodule Weber do
    use Application.Behaviour
 
    def start(_type, _args) do
        Weber.Supervisor.start_link
    end

    def stop(_state) do
        :ok
    end
end
</code></pre>

<p>Root supervisor:</p>

<pre><code class="language-elixir">defmodule Weber.Supervisor do
    use Supervisor.Behaviour
 
    def start_link do
        :supervisor.start_link({:local, __MODULE__}, __MODULE__, [])
    end
 
    def start_app(app_name, routes, root_directory, config) do
        :supervisor.start_child(__MODULE__, [app_name, routes, root_directory, config])
    end
 
    def init([]) do
      children = [ worker(Weber.App, [])]
      supervise children, strategy: :simple_one_for_one
    end
 
end
</code></pre>

<p>And simple gen_server:</p>

<pre><code class="language-elixir">defmodule Weber.App do
    use GenServer.Behaviour
 
    defrecord WeberApp,
      name:   nil, 
      routes: nil,
      config: nil,
      root:   nil,
      static_dir: nil,
      views_dir:  nil
    
    def start_link(app_name, routes, root_directory, config) do
        :gen_server.start_link({:local, app_name}, __MODULE__, [app_name, routes, root_directory, config], [])
    end
 
    def init([app_name, routes, root_directory, config]) do
        :gen_server.cast(:erlang.self(), :init)
        { :ok, WeberApp.new name: app_name, 
                            routes: routes, 
                            root: root_directory, 
                            config: config,
                            static_dir: root_directory ++ '/lib/static/',
                            views_dir:  root_directory ++ '/lib/views/' }
    end
 
    def handle_cast(:init, state) do
        {:noreply, state}
    end
 
    def handle_call(:routes, _from, state) do
      { :reply, state.routes, state }
    end
 
end
</code></pre>

<p>compile and start it with:</p>

<pre><code>$ iex -S mix 
</code></pre>

<h2 id="testing:5df44b8565d4251e584dfb856f87bd33">Testing</h2>

<p>There is ExUnit! It is a unit test framework that ships with Elixir. Let see in routing functions from the Weber:</p>

<pre><code class="language-elixir">def on(path, controller, action) do
        [[path: path, controller: controller, action: action]]
    end
 
    def on(routesList, path, controller, action) do
        :lists.append(routesList, [[path: path, controller: controller, action: action]])
    end
 
    @doc &quot;&quot;&quot;
      Router attribute
    &quot;&quot;&quot;
    def otherwise(path, controller, action) do
        on(path, controller, action)
    end
 
    def otherwise(routesList, path, controller, action) do
        on(routesList, path, controller, action)
    end
</code></pre>

<p>And now we can write unit tests for it with ExUnit:</p>

<pre><code class="language-elixir"> test &quot;Test for Weber.Route.on and Weber.Route.otherwise&quot; do
      r = on(&quot;/&quot;, 'controller1', 'main_action')
          |&gt; on(&quot;/user/0xAX/add&quot;, 'controller1', 'action2')
          |&gt; on(&quot;/user/:user/delete&quot;, 'controller1', 'action2')
          |&gt; otherwise(404, 'controller1', 'notfound')
    
      assert(r == [[path: &quot;/&quot;, controller: 'controller1', action: 'main_action'], 
                   [path: &quot;/user/0xAX/add&quot;, controller: 'controller1', action: 'action2'], 
                   [path: &quot;/user/:user/delete&quot;, controller: 'controller1', action: 'action2'], 
                   [path: 404, controller: 'controller1', action: 'notfound']
                  ])
  end
</code></pre>

<h2 id="libraries:5df44b8565d4251e584dfb856f87bd33">Libraries</h2>

<p>Although Elixir is now young language, it has good set of libraries:</p>

<ul>
<li><a href="https://github.com/guedes/exjson">exjson</a> - JSON parser and genarator in Elixir;</li>
<li><a href="https://github.com/elixir-lang/ecto">ecto</a> - A database wrapper and language integrated query for Elixir;</li>
<li><a href="https://github.com/myfreeweb/httpotion">httpotion</a> - The HTTP client for Elixir;</li>
<li><a href="https://github.com/josephwilk/amrita">amrita</a> - A polite, well mannered and thoroughly upstanding testing framework for Elixir;</li>
<li><a href="https://github.com/meh/elixir-socket">elixir-socket</a> - Socket wrapping for Elixir;</li>
<li><a href="https://github.com/yrashk/genx">genx</a> - Elixir-style library for most important OTP functionality;</li>
<li><a href="https://github.com/meh/elixir-datastructures">elixir-datastructures</a> - Datastructures for Elixir.</li>
</ul>

<p>and many more. Or you of course can use any erlang libraries. Just include it to your mix.exs file as:</p>

<pre><code class="language-elixir">...
 defp deps do
    [
      {:cowboy, &quot;0.8.6&quot;, github: &quot;extend/cowboy&quot;},
      {:ecto, github: &quot;elixir-lang/ecto&quot;},
      {:pgsql, github: &quot;ericmj/pgsql&quot;, branch: &quot;elixir&quot;},
      {:exjson, github: &quot;guedes/exjson&quot;}
    ]
  end
...
</code></pre>

<p>and execute</p>

<pre><code>$ mix deps.get 
</code></pre>

<p>In the end of this post i want to say many thanks to the Elixir community which helped me all this day, you&rsquo;re great!</p>


          <div style="float:left;">
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="0xAX">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>	
	<div class="g-plusone" data-size="medium"></div>
      </div>
    
  </div>
  <div id="disqus_thread" style="width: 180% !important;"></div>
</div>
<div style="width: 100%;">

<script type="text/javascript">
var disqus_shortname = "0xAX";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "0xAX";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://0xax.github.io//js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-64079379-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

</div>
